# Uniswap是什么？
简单来说，Uniswap是一个去中心化的交易平台，它的本质是运行在以太坊上的自动做市智能合约。

区别于中心化交易所的订单簿模型，它采用了流动性池加恒定乘积公式算法为加密资产提供实时报价和兑换服务。


## 自动化做市商
传统的交易所有一个订单薄，订单薄上记录着买卖方向，数量和出价，交易所负责对买卖双方进行配对，一旦订单薄中最高价格低于或等于最低价格，就会促成交易，同时会产生一个新的成交价，传统交易所有以下特点：

* 市场上必须要有用户进行挂单，要有一定量的订单（市场流动）。
* 订单必须重叠才能成交，即买价高于或等于卖价。
* 需要将资产存储在交易所。

在订单薄模型市场中，买家期望用最低的价格买到想要的资产，而卖家则是期望用最高价格卖出同一项资产，如果交易要成立，买卖双方必须要在价格上达成共识，一是买家提高出价，二是卖家降低出价。

如果双方都不愿意改变出价，这时候就要依靠做市商的参与。简单来说，做市商是一个促进交易的实体，它会在买卖两个方向上挂单，让想要交易的参与方只要跟做市商的订单撮合就能完成交易，而不需要等待对手方出现才能交易，极大的提高了市场的流动性。

为什么Uniswap不采用订单薄模型？

因为Uniswap主要考虑部署在以太坊上，而以太坊每秒只有15笔左右的交易。订单薄模型依赖一个或多个外部做市商对某项资产一直不断的做市，因此以太坊的TPS过低不支持做市商高频的交易。所以后面在高TPS的L2上也出现了像dydx这样的订单簿模型的DEX。

自动化做市商（以后简称AAM）模式不需要买卖双方进行挂单，而是靠：
* 流动池：使用流动池来提供买卖双方交易，做市商只要把资金放入流动池即可
* 恒定乘积公式：按照流动池中Token的数量，自动计算实时价格

## 流动池

流动池就是锁定在智能合约中所有的代币以及资金的总称，流动是资金转为代币，或代币转为资金的意思。

一个完整的流动池分为2个部份，分别表示不同的货币，成为一个交易对，在Uniswap V1中就是ETH及ERC20代币，在Uniswap V2中是支持不同ERC20代币直接交换，所以在Uniswap V2中的流动池可以允许两边是不相同的ERC20代币，其中ETH会自动转换成以WETH代币。为了简化，直接以ETH-ERC20交易对作为例子。

Uniswap是无法自己变出钱来，因此需要依赖外部资金向合约中提供流动性，向Uniswap流动池中提供流动性的用户被称为流动性提供者，当流动性提供者向Uniswap中注入流动性的时候，Uniswap会铸造出一个流动性代币(LP)，铸出LP代币数量是与用户注入的资金所占流动池中的资金比例相关,动性提供者可以选择在任何时间销毁自己持有的流动性代币。为了鼓励用于向Uniswap的流动池中提供更多的流动性，Uniswap会从每笔交易总额中抽取0.3%当成交易手续费，并将手续费全额交给那些将注资金到Uniswap资金池提供流动性的流动性提供者。

## 恒定乘积公式
Uniswap定价模型非常简洁，它的核心思想是恒定乘积公式 $x×y=k$
。其中x和y分别代表流动池中两种资产的数量，要求无论资产数量如何变化，两种资产数量的乘积要恒等于k。

x×y=kx×y=k的函数图像如下：

## Uniswap版本
截止目前（2022.12），Uniswap一共发布了3个版本。

第一个版本是在2018年11月发布的，它只允许token和eth之间的交易，币币交易需要使用链式交易实现。

第二个版本在2020年3月上线，这个版本主要是实现了任何ERC20代币之间的直接交易。

第三个版本在2021年5月份上线，主要是使用区间流动性提高了资本效率。

建议读者从V1开始阅读，一是V1代码相对简单，更容易理解核心思想，二是可以看到协议是如何一步一步优化的。

## 参考&引用
https://learnblockchain.cn/article/1448